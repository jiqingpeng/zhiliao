<!DOCTYPE html>
<html>
<head>
	<title>酒店预订</title>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="../../css/index/hotel.css">
	<link rel="stylesheet" href="../../css/index/base.css">
	<link rel="stylesheet" href="../../css/index/hotelReserve.css">

</head>
<body>
	<div class="ReserHead">
		<div class="ReserHeadCon">
			<div class="ResHeadTitle">
				<div class="ResHeaTitTour">主办方推荐酒店</div>
				<div class="ResHeaIndent">
					<span><a href="">登录</a></span>
					<span><a href="">注册</a></span>
					<span class="phone">4007-777-777</span>
				</div>
			</div>
			<div class="ResHeadPay">
				<img src="../../img/index/processB.png">
			</div>
		</div>
	</div>
	<div class="hotelReserve">
		<div class="ReserContent clearfix">
			<div class="ReserConLeft">
				<div class="resConShow">
					<img class="roomImg" src="../../img/index/grogshop01.jpg">
				</div>
				<div class="resConDetail">
					<input type="hidden" id="ResId"/>
					<div class="colorBlack ResName">北京饭店</div>
					<div class="colorDead address">北京 东城区 东长安街333号</div>
					<div class="resConDetDes">
						<div class="colorBlack productType">A座高级标准房(内宾)(双早)</div>
						<div>
							<span class="spanWidth">床型：<span class="colorBlack bedType">双床</span>
							</span>
							<span>面积：<span class="colorBlack roomsize">40平方米</span></span>
						</div>
						<div>
							<span class="spanWidth">楼层：<span class="colorBlack floor">7-14层</span></span>
							<span>早餐：<span class="colorBlack breakCount">双份</span></span>
						</div>
						<div>
							<span class="spanWidth">加床：<span class="colorBlack addbed">加床价RMB：415</span></span>
							<span>窗户：<span class="colorBlack hasWindow">有窗</span></span>
						</div>
						<!-- <div class="warm">
							<div class="warmPrompt">温馨提示</div>
							<div>1、预订每间房至少需要提供一位实际入住客人姓名。且入住时必须告知酒店订单上的名字，不能有错别字。</div>
						</div> -->
					</div>
					<div class="resConDetPri">
						<div>
							<span class="indent">订单总额</span>
							<span>-------------------------------</span>
							<span class="price">¥888</span>
						</div>								
						<div class="write">房费请于酒店前台支付</div>
						<div class="write">酒店确认入住后担保费用全部返还</div>
					</div>
				</div>
			</div>
			<div class="ReserConRight clearfix">
				<div class="reserGrogInfo clearfix">
					<div class="reserInfo clearfix">
						<div class="reserInfoChar heightLeft">预订信息</div>
						<input type="hidden" id="unitprice"/>
						<div class="reserDetail heightRight">
							<div class="reserInfoDet">
								<span>入离日期&nbsp;&nbsp;&nbsp;&nbsp;<span class="detailDate">2017-6-23</span><input class="detailamend none" type="text">&nbsp;&nbsp;到&nbsp;&nbsp;<span class="detailDate">2017-6-24</span><input type="text" class="detailamend none"></span>&nbsp;&nbsp;&nbsp;&nbsp;
								<span>共1晚</span><span><a href="#" class="alterData">修改日期</a></span>
							</div>
							<div class="reserCount">
								<span class="resRoomCon">房间数量</span>
								<span class="resCouStyle active resCouSpan">1</span>
								<span class="resCouSpan">2</span>
								<span class="resCouSpan">3</span>
								<span class="resCouSpan">4</span>
								<span class="resCouSpan">5</span>
								<span class="resCouSpan">6</span>
								<span class="resCouSpan">7</span>
								<span class="resCouSpan">8</span>
							</div>
							<div class="reserTotal">
								<span>房费总计&nbsp;&nbsp;<span class="resTolPrice">¥888</span><span>
								<span class="particulars"><a href="">明细</a></span></span>
								<!-- <div class="particularsHide none">
									<div>以下价格是,每日每间的房价</div>
									<div class="particHideData">
										<div class="particHideWeek">
											<div>2017年6月20日</div>
											<div>星期二</div>
										</div>
										<div class="particHidePrice">
											<div class="price">¥245</div>
											<div>无早</div>
										</div>
									</div>
								</div> -->
							</div>
							<br>
						</div>
					</div>
					<div class="checkInfo clearfix">
						<div class="checkInfoLeft">
							<span class="orderLabel">入住信息</span>
						</div>
						<div class="checkInfoRight">
							<br><br>
							<div class="compellation">
								<span class="LinkManlabel">住客姓名</span>&nbsp;&nbsp; <input type="text" name="LinkManName" class="linkManName01" placeholder="请输入住客真实姓名" />
							</div>
							<!-- <div class="compellation">
								<span class="LinkManlabel"></span>&nbsp;&nbsp; <input type="text" name="LinkManName" placeholder="请输入住客真实姓名"/>
							</div> -->
							<div class="compellation namePrompt">
								<span class="itemLabel"></span>&nbsp;&nbsp;<span>所需姓名需与入住时所持证件一致.</span><span class="regulation"><a href="">填写规则</a></span>
								<div class="infoIntroHide none">请填写中文或英文姓名，英文姓名格式为zhang/sanfeng。</div>
							</div>
							<div class="compellation">
								<span class="itemLabel">手机号码:</span>&nbsp;&nbsp; <input type="text" name="LinkManMobile" class="linkManMobile" placeholder="请填写手机号码" />
							&nbsp;&nbsp;预定成功后会向您发送短信通知
							</div>
							<div class="compellation">
								<span class="itemLabel">到达时间</span>&nbsp;&nbsp;
								<select class="arrivalTime">
									<option value='11'>11点</option>
									<option value='12'>12点</option>
									<option value='13'>13点</option>
									<option value='14' selected>14点</option>
									<option value='15'>15点</option>
									<option value='16'>16点</option>
									<option value='17'>17点</option>
									<option value='18'>18点</option>
									<option value='19'>19点</option>
									<option value='20'>20点</option>
									<option value='21'>21点</option>
									<option value='22'>22点</option>
									<option value='23'>23点</option>
									<option value='24'>24点</option>
									<option value='1'>1点</option>
									<option value='2'>2点</option>
									<option value='3'>3点</option>
									<option value='4'>4点</option>
									<option value='5'>5点</option>
								</select>&nbsp;&nbsp;
								<span><span class="warn">00:00</span>需担保房费<span class="warn">888</span>元</span>
							</div>
						</div>	
					</div>
					<div class="invoiceInfo clearfix">
						<div class="invoInfoLeft ">发票信息</div>
						<div class="invoInfoRight heightRight">
							<br><br>
							<div class="invoInfoRightCon marginLeft">
							如需房费发票，请从酒店前台索取。
							</div>
						</div>
					</div>
					<div class="card clearfix">
						<div class="cardLeft">信用卡信息</div>
						<div class="cardRight">
							<br><br>
							<div class="marginLeft">
								<div id="selCard">选择您的卡种</div>
								<br>
								<div>
									<span class="spanCard"><input type="hidden" value="中国农业银行信用卡"></span>
									<span class="spanCard chinaCard"><input type="hidden" value="中国银行信用卡"></span>
									<span class="spanCard constructionCard"><input type="hidden" value="中国建设银行信用卡"></span>
									<span class="spanCard brightenCard">
										<input type="hidden" value="中国光大银行信用卡">
									</span>
									<br>
									<span class="spanCard businessCard"><input type="hidden" value="兴业银行信用卡"></span>
									<span class="spanCard CITICCard"><input type="hidden" value="中信银行信用卡"></span>
									<span class="spanCard attractCrad"><input type="hidden" value="招商银行信用卡"></span>
									<span class="spanCard livelihoodCard"><input type="hidden" value="中国民生银行信用卡"></span>
									<br>
									<span class="spanCard richCard"><input type="hidden" value="富滇银行"></span>
									<span class="spanCard developmentCard"><input type="hidden" value="中国民生银行信用卡"></span>
									<span class="spanCard hangzhouCard"><input type="hidden" value="杭州银行"></span>
									<span class="spanCard IndustryCard"><input type="hidden" value="中国工商银行信用卡"></span>
									<br>
									<span class="spanCard ningboCard"><input type="hidden" value="宁波银行信用卡"></span>
									<span class="spanCard dawkCard">
										<input type="hidden" value="邮政储蓄银行信用卡">
									</span>
									<span class="spanCard shanghaiCard"><input type="hidden" value="上海银行信用卡"></span>
									<span class="spanCard safetyCard">
										<input type="hidden" value="平安银行信用卡">
									</span>
									<br>
									<span class="spanCard SPDBCard">
										<input type="hidden" value="浦发银行信用卡">
									</span>
								</div>
								<div class="cardDetail none">
									<ul>
										<li>
											<label class="cardLabel">信用卡卡号</label>
											<input type="text" name="CardNumber" class="cardInp CardNumber" placeholder="输入信用卡15位或16位卡号"/>
											<span class="cardPrompt">输入信用卡15位或16位卡号</span>
										</li>
										<li>
											<label class="cardLabel">CVV2验证码</label>
											<input type="text" name="CardValueCode" class="cardInp CardValueCode" placeholder="请填写验证码"/>
											<span class="cardPrompt">信用卡背面签名栏里的后三位</span>
										</li>
										<li>
											<label class="cardLabel">有效期限</label>
											<select class="cardInp CardValueDateMM">
												<option selected>月份</option>
												<option>01</option>
												<option>02</option>
												<option>03</option>
												<option>04</option>
												<option>05</option>
												<option>06</option>
												<option>07</option>
												<option>08</option>
												<option>09</option>
												<option>10</option>
												<option>11</option>
												<option>12</option>
											</select>
											<select class="cardInp CardValueDateYY">
												<option selected>年份</option>
												<option>17</option>
												<option>18</option>
												<option>19</option>
												<option>20</option>
												<option>21</option>
												<option>22</option>
												<option>23</option>
												<option>24</option>
												<option>25</option>
												<option>26</option>
												<option>27</option>
												<option>28</option>
												<option>29</option>
												<option>30</option>
											</select>
											<input type="hidden" name="CardValueDate"/>
											<span class="cardPrompt">位于信用卡卡号下方有效期</span>
										</li>
										<li>
											<label class="cardLabel">持卡人姓名</label>
											<input type="text" name="CardUserName" class="cardInp CardUserName" placeholder="输入持卡人姓名"/>
										</li>
										<li>
											<label class="cardLabel">持卡人手机号</label>
											<input type="text" name="mobile" class="cardInp mobile" placeholder="输入持卡人手机号"/>
										</li>
										<li>
											<label class="cardLabel">持卡人身份证</label>
											<input type="text" name="CredentialNumber" class="cardInp CredentialNumber" placeholder="输入持卡人身份证号"/>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
					<div class="attention clearfix">
						<div class="attentionLeft">预订须知</div>
						<div class="attentionRight">
							<p>1、当前房间紧张，需冻结/暂扣您信用卡金额<span class="totPrice">¥888</span>用于担保。订单确认后，该酒店房间保留至2017年7月8日12:00。如订单不确认，同程将立即进行解冻/退款。订单一经确认，不可变更/取消。未如约入住，同程将扣除您的担保费用<span class="totPrice">¥888</span>支付酒店。成功入住及付款离店，同程向酒店确认后立即操作解冻/退款，5-7个工作日恢复额度/到账。</p>
							<p>2、入住人需凭有效证件入住。</p>
							<p>3、为保证您的预订顺利完成，请正确填写信用卡信息。若信用卡预授失败，您选择的取消险将自动取消。</p>
							<!-- <div class="attentionDes">
								<span class="marginLeft">1、预订此产品，需预付房费</span>
								<span class="totPrice">¥1274</span>，如订单不确认将全额退款至您的付款账户。该订单确认后不可被取消，若未入住将收取您全额房费<span id="reimburse">¥1274</span>
							</div>
							<br>	
							<div class="attentionDes marginLeft">
								<span class="marginLeft">2、入住人需凭有效证件入住。</span>
							</div> -->
						</div>
					</div>
					
				</div>
			</div>
		</div>
		<div class="immedPayment">
				<button class="hotelsave">提交订单</button>&nbsp;
				<div class="immedPaymentDes"><span>订单金额 : <span class="immedPaymentPrice">¥888</span>&nbsp;（房费<span class="totPrice">¥888</span>，所有费用请于酒店前台支付）</span></div>
		</div>
	</div>
</body>
</html>
<script type="text/javascript" src="../../js/jquery.min.js"></script>
<script type="text/javascript" src="../../js/common/common.js"></script>
<script type="text/javascript">
// 获取酒店及房间ID
var hotelData = getUrlJson("dataKey");
var roomNum = 1; // 酒店房间数

$(function(){

	initPage();
	
	$(".heightLeft").height($(".heightRight").height()-"40");
	$(".alterData").on("click", function(){
		$(".detailDate").toggleClass("none");
		$(".detailamend").toggleClass("none");
		if($(".alterData").text()=="修改日期"){
			$(".alterData").text("确 定");
		}else{
			$(".alterData").text("修改日期");
		}

	})
	$(".particulars").on("mouseover", function(){
		$(".particularsHide").removeClass("none");
	});
	$(".particulars").on("mouseleave", function(){
		$(".particularsHide").addClass("none");
	});
	$(".regulation").on("mouseover", function (){
		$(".infoIntroHide").removeClass("none");
	});
	$(".regulation").on("mouseleave", function () {
		$(".infoIntroHide").addClass("none");
	})
	$(".resCouSpan").on("click", function () {
		$(this).addClass("active").siblings().removeClass("active");
		roomNum = $(this).text(); // 酒店房间数
		var unitprice = $("#unitprice").val();
		$(".resTolPrice").text("¥"+unitprice*roomNum)
		$(".price").text("¥"+unitprice*roomNum);
		$(".totPrice").text("¥"+unitprice*roomNum);
		$(".immedPaymentPrice").text("¥"+unitprice*roomNum);

		// 增加入住客人
		var linkManNum = $(".LinkManlabel").length; 
		if(roomNum > linkManNum){
			var str = '';
			for(var i=0;i<(roomNum-linkManNum);i++){
				str += '<div class="compellation">'+
							'<span class="LinkManlabel"></span>&nbsp;&nbsp; <input type="text" name="LinkManName" placeholder="请输入住客真实姓名"/>'+
						'</div>';
			}
			$(".namePrompt").before(str);
		} else {
			for(var i=linkManNum-1,j=0;j<(linkManNum-roomNum);j++,i--){
				$($(".LinkManlabel")[i]).parent().remove();
			}
		}

	})
	$(".spanCard").on("click", function(){
		$(this).addClass("redActive").siblings().removeClass("redActive");
		var content = "您已选择" + $(this).children().val()
		$("#selCard").text(content);
		$(".cardDetail").removeClass('none');
	})
	// $(".traSecRight .checkBox").on("click", function(){
	// 	$(".traSecHide").toggleClass("none");
	// 	$(this).toggleClass("borderChange");
	// 	$(".roomRate").toggleClass("none");
	// 	$(".cancel").toggleClass("none");
	// 	// $(".allRisksDes").toggleClass("none");
	// 	$(".traSecLeft").css("height",$(".traSecHide").height());
	// });
	// $(".invoInfoRight .checkBox").on("click", function(){
	// 	$(".invoiceHide").toggleClass("none");
	// }); 	
	$(".hotelsave").on("click", function(){
		var arriveTime = $(".arriveTime").val();
		var credentialNumber = $(".CredentialNumber").val();
		var linkManMobile = $(".linkManMobile").val();
		var linkManName = $(".linkManName01").val();
		var bankId = $(".bankId").val();
		var bankName = $(".bankName").val();
		var cardNumber = $(".CardNumber").val();
		var cardUserName = $(".CardUserName").val();
		var cardValueCode = $(".CardValueCode").val();
		var cardValueDate = '20'+$(".CardValueDateYY").val()+'/'+$(".CardValueDateMM").val();
		var mobile = $(".mobile").val();


		var actid = sessionStorage.getItem('actId');
		var postData = 'activityId='+actid+'&arriveTime='+arriveTime+
				'&bookCount='+roomNum+'&credentialName=身份证'+
				'&credentialNumber='+credentialNumber+'&linkManMobile='+linkManMobile+'&mobile='+mobile+
				'&bankId='+bankId+'&bankName='+bankName+
				'&cardNumber='+cardNumber+'&cardUserName='+cardUserName+'&cardValueCode='+cardValueCode+'&cardValueDate='+cardValueDate+'&orderChilds=0'+
				'&paymentSign=2&orderAdults='+roomNum+
				'&proId='+hotelData.ProId+'&productUniqueId='+hotelData.ProductUniqueId+'&resId='+hotelData.hotelId+'&linkManName='+linkManName+
				'&lyHotelPassengerList[0].mobile='+'13601250514'+'&lyHotelPassengerList[0].name=巩克春'+
				'&tcHotelResourceUseList[0].checkPrice='+$("#unitprice").val()+'&tcHotelResourceUseList[0].useDate=2017-06-29';

				// "bankId":"558",
				// "bankName":"招商银行信用卡",
				// "cardNumber":"3568891143637767",
				// "cardUserName":"张玉龙",
				// "cardValueCode":"127",
				// "cardValueDate":"2021/09",

		// postData.activityId = actid;
		// postData.arriveTime = 12;
		// postData.bookCount = 1;
		// postData.credentialName = "身份证";
		// postData.credentialNumber = "370982199010050633";
		// postData.linkManMobile = "13601250514";
		// postData.linkManName = "巩克春";
		// postData.linkManSex = "1";
		// postData.lyHotelPassengerList = [{
		// 	"mobile":"13601250514",
		// 	"name":"巩克春",
		// }];
		// postData.mobile = "13601250514";
		// postData.orderAdults = 1;
		// postData.paymentSign = 2;
		// postData.proId = "2067528";
		// postData.productUniqueId = "6566460";
		// postData.resId = hotelData.hotelId;
		//postData.tcHotelResourceUseList = [{
		// 	"checkPrice":"228",
		// 	"useDate":"2017-06-28"
		// }];
		console.log(postData);
		// return;
		$.myAjax({
			url: basePath + 'user/hotelorder/save.do',
			data: postData,
			success: function(result) {
				console.log(result);
			},
			error: function(result) {
				myAlert('请求失败！','slow');
			}
		});
	});
})

function initPage(){

	$.myAjax({
		url: basePath + 'tc/hotel/getroom.do',
		data: {
			// id: '0a90d9c5867340b380c836f34621c03f',
			id: hotelData.ResId, 
			proId: hotelData.ProId,
			pduId:hotelData.ProductUniqueId, 
			stime:hotelData.stime,
			etime:hotelData.etime
			},
		success: function(result){
			console.log(result);
			if(result.flag){
				
				$(".roomImg").html(result.data.hotelRoomImg);
				var hotelDetail = result.data.hotelDetail;
				var roomDetail = result.data.hotelRoomInfo;
				$(".ResName").html(hotelDetail.ResName);
				$(".address").html(hotelDetail.ProvName+'&nbsp;'+hotelDetail.SectionName+'&nbsp;'+hotelDetail.Address);
				$(".productType").html(roomDetail.SupPriceName);
				$(".bedType").html(roomDetail.ResProProps.床型);
				$(".roomsize").html(roomDetail.RoomSize);
				$(".floor").html(roomDetail.RoomFloor);
				if(roomDetail.BreakfastCount > 1) {
					var breakCount = '双早';
				} else if(roomDetail.BreakfastCount == 1){
					var breakCount = '单早';
				} else {
					var breakCount = '无';
				}
				$(".breakCount").html(breakCount);
				if(roomDetail.ResProProps.加床价 > 0){
					$(".addbed").html(roomDetail.ResProProps.加床价);
				} else {
					$(".addbed").html(roomDetail.ResProProps.加床);
				}
				$(".hasWindow").html(roomDetail.HasWindows==1?'有窗':'无窗');
				$(".price,.resTolPrice,.totPrice,.immedPaymentPrice").html(result.data.sale);
				$("#unitprice").val(result.data.sale);

			}
		},
		error: function(result){
			myAlert('请求失败！','slow');
		}
	});

}
</script>
