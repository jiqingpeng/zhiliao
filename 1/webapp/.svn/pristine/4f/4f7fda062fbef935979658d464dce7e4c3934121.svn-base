<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>详情</title>
	<link rel="shortcut icon" href="../../img/webicon.ico" type="image/x-icon"/>
	<link rel="stylesheet" href="../../css/index/base.css">
	<link rel="stylesheet" href="../../css/index/public.css">
	<link rel="stylesheet" href="../../css/index/detail.css">
</head>
<body>
	<div class="head">
		<div class="clearfix hnav">
			<ul class="fl">
				<li class="fl">
					<a href="index.html">
						<img class="imgTitle" src="../../img/index/logo.png">
					</a>
				</li>
				<!-- <li class="fl"><a href="detail.html">解决方案</a></li>
				<li class="fl"><a href="second.html">合作单位</a></li>
				<li class="fl"><a href="cation.html">关于我们</a></li> -->
			</ul>
			<ul class="fr">
				<li class="fl"><a id="user_center" href="../user/activityList.html"></a></li>
				<li class="fl" id="user_name"></li>
				<li class="fl"><a id="login_out" href="javascript:;"></a></li>
			</ul>
		</div>
	</div>
	<div class="contain">
		<input type="hidden" id="id"/> <!-- 活动id -->
		<input type="hidden" id="logType"/>
		<div class="bannimg">
			<!-- <a class="fl" href="index.html"><img class="logol" src="../../img/index/banner.jpg" alt="logoname"></a> -->
			<img class="logor fr" src="../../img/banner.png" alt="banner">
		</div>
		<div class="clearfix messTitle">
			<div class="line fl"></div>
			<div class="fl second-nav">
				<a href="index.html" class="fl">首页</a>
				<a href="javascript:;" class="fl">&gt;全部活动</a>
				<a class="detail" href="" class="fl">&gt;活动详情</a>
			</div>
			<!-- <h2 class="messName fl"></h2>
			<p class="messCompany fl w290"></p> -->
		</div>
		<div class="wrap clearfix">
			<div class="wrap-c fl">
				<div class="messIntroTitle">
					<p class="messName"></p>
					<a href="#" class="messCompany"></a>
				</div>
				<div class="introBox">
					<div class="message" id="introduction">
					</div>
				</div>
				<div class="mess-img clearfix">
					
				</div>
				<!-- <ul class="contact-left">
					<li class="con-item">
						<span class="color-f60">时间</span>
						<span>:2017年</span>
					</li>
					<li class="con-item">
						<span class="color-f60">地点</span>
						<span class="mess_address">:2017年</span>
					</li>
					<li class="con-item">
						<span class="color-f60">联系人</span>
						<span>:2017年</span>
					</li>
					<li class="con-item">
						<span class="color-f60">电话</span>
						<span>:2017年</span>
					</li>
				</ul> -->
				<!-- 嘉宾介绍 -->
				<!-- <ul class="act-item">
					<div class="act-item-tit clearfix">
						<div class="txt fl">嘉宾介绍</div>
						<div class="line fl"></div>
					</div>
					<div class="act-item-cont"></div>
				</ul> -->
				<div class="act-item">
					<div class="act-item-tit clearfix">
						<div class="txt fl">会议位置</div>
						<div class="line fl"></div>
					</div>
					<div class="act-item-cont" id="allmap"></div>
					<div class="act-address"></div>
				</div>
			</div>
			<div class="wrap-r fr">
				<div class="group">
					<div class="clearfix singup">
						<span class="fl">已报名人数:</span>
						<span id="totalAttend" class="fl"></span>
						<span class="sing-txt fl">人</span>
					</div>
					<div class="item">
						<div class="btnGroup">
							<!-- <p class="sign gray">
								<a href="javascript:;">我要关注</a>
							</p> -->
							<p class="sign">
								<a class="enroll" href="#">立即报名</a>
							</p>
							<!-- <p class="sign gray">
								<a class="genroll" href="#">团体报名</a>
								<a href="javascript:;">团体报名</a>
							</p> -->
						</div>
					</div>
				</div>
				<div class="group org">
					<h4>组织机构</h4>
					<div class="item orginfo">
						<ul class="orgList">
							
						</ul>
					</div>
				</div>
				<div class="group messTime">
					<h4 class="time">会议时间</h4>
					<div class="item" id="mess_time">
					</div>
				</div>
				<div class="group">
					<h4>动态信息</h4>
					<div class="item">
						<div class="news">
							
						</div>
						
					</div>
				</div>
				<div class="group contact">
					<h4>联系我们</h4>
					<div class="item">
						<!-- <div class="tit">
							择财汇中科技有限公司
						</div> -->
						<div class="code-group clearfix">
							<div class="mess code-item fl">
								<div class="code" id="qrcode" src="" alt="code">
								</div>
								<p class="Txt">会议二维码</p>
							</div>
							<div class="plat code-item fl">
								<img class="code" src="../../img/index/publicvx.jpg" alt="code">
								<p class="fl Txt">平台二维码</p>
							</div>
						</div>
						<ul id="contact_our">
							<li class="contactUser clearfix">
								<img class="fl" src="../../img/index/act-person.png" alt="icon">
								<span class="fl conTit">联系人:</span>
								<span class="fl conTxt userTxt"></span>
							</li>
							<li class="contactPhone clearfix">
								<img class="fl" src="../../img/index/act-phone.png" alt="icon">
								<span class="fl conTit">联系电话:</span>
								<span class="fl conTxt"></span>
							</li>
							<li class="contactEmail clearfix">
								<img class="fl" src="../../img/index/act-email.png" alt="icon">
								<span class="fl conTit">联系邮箱:</span>
								<span class="fl conTxt"></span>
							</li>
							<li class="contactAddress clearfix">
								<img class="fl" src="../../img/index/act-address.png" alt="icon">
								<span class="fl conTit">联系地址:</span>
								<span class="fl conTxt"></span>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		
	</div>
	<div class="foot">
			<ul class="f-list clearfix">
				<!-- <li class="fl tell no">
				</li> -->
				<li class="fl"><a href="indepPage/about.html" target="_blank">关于我们</a></li>
				<li class="fl"><a href="indepPage/contant.html" target="_blank">联系我们</a></li>
				<li class="fl"><a href="indepPage/help.html" target="_blank">帮助中心</a></li>
				<li class="fl"><a href="javascript:;">会务商加盟</a></li>
				<li class="fl"><a href="javascript:;">会展商加盟</a></li>
				<li class="fl"><a href="javascript:;">媒体加盟</a></li>
				<li class="fl"><a href="javascript:;">场馆加盟</a></li>
				<li class="fl"><a href="javascript:;">旅游合作</a></li>
				<li class="fl"><a href="indepPage/companyNews.html" target="_blank">公司新闻</a></li>
				<!-- <li class="fl">
					<ul class="foot-message">
						<li class="font24"><a href="indepPage/about.html">关于我们</a></li>
						<li><a href="#">关于群英会</a></li>
						<li><a href="#">加入我们</a></li>
						<li><a href="#">免责申明</a></li>
					</ul>
				</li>
				<li class="fl">
					<ul class="foot-message">
						<li class="font24"><a href="indepPage/contant.html">联系我们</a></li>
						<li><a href="#">电话</a></li>
						<li><a href="#">官方微信</a></li>
						<li><a href="#">新浪微博</a></li>
					</ul>
				</li>
				<li class="fl">
					<ul class="foot-message">
						<li class="font24"><a href="#">加盟</a></li>
						<li><a href="#">会务商加盟</a></li>
						<li><a href="#">会展商加盟</a></li>
						<li><a href="#">媒体加盟</a></li>
					</ul>
				</li>
				<li class="fl">
					<ul class="foot-message">
						<li class="font24"><a href="#">合作</a></li>
						<li><a href="#">旅游合作</a></li>
						<li><a href="#">媒体合作</a></li>
						<li><a href="#">资助合作</a></li>
					</ul>
				</li>
				<li class="fl font24 la"><a href="#">帮助</a></li> -->
			</ul>
			<p class="p1">未经gconfs.com同意不得转发网站会议信息</p>
			<p class="p2">京ICP备1708133号</p>
	</div>
	<div class="introPos">
		<div class="introTxt"></div>
		<img class="introIcon" src="../../img/index/del.jpg"/>
	</div>
</body>
<script src="../../js/jquery.min.js"></script>
<script src="../../js/common/common.js"></script>
<script src="../../js/common/qrcode.min.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=FB6c98d828da5bf508fb357f9ee535ef"></script>
<script src="../../js/user/userMain.js"></script>
<script>

var actState = 2; // 活动状态，默认2（未结束）

	$(function(){
		$(".group").on("mouseover", function(){
			$(this).find(".row").css("display", "block");
		});
		$(".group").on("mouseleave", function(){
			$(this).find(".row").css("display", "none");
		})
		//init获取页面信息和登陆状态
		var url=basePath+"index/activity.do";
		//截取ID
		var id = '';
		if(Request('location')){
			id = Request('location');
			$("#id").val(id);
		} else if(sessionStorage.getItem('actId')) {
			id = sessionStorage.getItem('actId');
			$("#id").val(id);
		}
		var type = Request('type');
		if(!id){ // 如果没有id,禁止请求
			return false;
		}
		//初始化
		init(id,type);
		function init(id,type){
			$.myAjax({
				url: url,
				type: 'GET',
				data:{id:id},
				success:function(result){
					console.log(result)
					if(result.flag){
						console.log(result)
						// 获取用户登陆状态信息
						if(result.status.url){
							$('#user_name').html(result.status.nick);
							$('#user_center').html('用户中心');
							$('#login_out').html('注销');
							$('#user_center').attr('href',basePath+result.status.url);
							$("#logType").val(1);
						}else{
							$("#logType").val(0);
						};
						//会议名称
						$('.messName').html(result.data.activity.name);
						//单位名称
						$('.messCompany').html(result.data.orgName);
						// .attr('href','http://'+result.data.orgUrl+'.gconfs.com');
						//会议地址
						initMap(result.data.activity.longtitude,result.data.activity.latitude);
						//会议日期
						if(result.data.activity.stime){
							var messData=
										'<div class="mess-date">'+
											'<p class="bold date-tit">'+
												'<img class="icon" src="../../img/index/mess-icon1.png" />'+
												'<span class="date txt">会议时间<span>'+
											'</p>'+
											'<p class="mess-date-time clearfix">'+
												'<span class="fr">'+getSubstring(result.data.activity.stime,0, 11)+
												'</span>'+
											'</p>'+
										'</div>';
							$('#mess_time').append(messData);
						};
						//征文投稿截止日期
						if(result.data.activity.paperEtime){
							var messData=
										'<div class="mess-date">'+
											'<p class="bold date-tit">'+
												'<img class="icon" src="../../img/index/mess-icon1.png" />'+
												'<span class="date txt">征文投稿截止日期<span>'+
											'</p>'+
											'<p class="mess-date-time clearfix">'+
												'<span class="fr">'+getSubstring(result.data.activity.paperEtime,0, 11)+
												'</span>'+
											'</p>'+
										'</div>';
							$('#mess_time').append(messData);
						};
						//现场报道日期
						if(result.data.activity.signupStime){
							var messData=
										'<div class="mess-date">'+
										'<p class="bold date-tit">'+
											'<img class="icon" src="../../img/index/mess-icon1.png" />'+
											'<span class="date txt">现场报到日期<span>'+
										'</p>'+
										'<p class="mess-date-time clearfix">'+
											'<span class="fr">'+getSubstring(result.data.activity.signupEtime,0, 11)+
											'</span>'+
											'<span class="txt fr">至</span>'+
											'<span class="fr">'+getSubstring(result.data.activity.signupStime,0, 11)+
											'</span>'+
										'</p>'+
									'</div>';
							$('#mess_time').append(messData);
						};
						//论文提交日期
						if(result.data.activity.signupStime){
							var messData=
										'<div class="mess-date">'+
										'<p class="bold date-tit">'+
											'<img class="icon" src="../../img/index/mess-icon1.png" />'+
											'<span class="date txt">现场报到时间<span>'+
										'</p>'+
										'<p class="mess-date-time clearfix">'+
											'<span class="fr">'+getSubstring(result.data.activity.signupEtime,0, 11)+
											'</span>'+
											'<span class="txt fr">至</span>'+
											'<span class="fr">'+getSubstring(result.data.activity.signupStime,0, 11)+
											'</span>'+
										'</p>'+
									'</div>';
							$('#mess_time').append(messData);
						};
						//缴费日期
						if(result.data.activity.payStime){
							var messData=
										'<div class="mess-date">'+
										'<p class="bold date-tit">'+
											'<img class="icon" src="../../img/index/mess-icon1.png" />'+
											'<span class="date txt">缴费日期<span>'+
										'</p>'+
										'<p class="mess-date-time clearfix">'+
											'<span class="fr">'+getSubstring(result.data.activity.payEtime,0, 11)+
											'</span>'+
											'<span class="txt fr">至</span>'+
											'<span class="fr">'+getSubstring(result.data.activity.payStime,0, 11)+
											'</span>'+
										'</p>'+
									'</div>';
							$('#mess_time').append(messData);
						};
						//论文审核日期
						if(result.data.activity.checkStime){
							var messData=
										'<div class="mess-date">'+
										'<p class="bold date-tit">'+
											'<img class="icon" src="../../img/index/mess-icon1.png" />'+
											'<span class="date txt">论文审核日期<span>'+
										'</p>'+
										'<p class="mess-date-time clearfix">'+
											'<span class="fr">'+getSubstring(result.data.activity.checkEtime,0, 11)+
											'</span>'+
											'<span class="txt fr">至</span>'+
											'<span class="fr">'+getSubstring(result.data.activity.checkStime,0, 11)+
											'</span>'+
										'</p>'+
									'</div>';
							$('#mess_time').append(messData);
						};
						//报名日期
						if(result.data.activity.signupStime){
							var messData=
										'<div class="mess-date">'+
										'<p class="bold date-tit">'+
											'<img class="icon" src="../../img/index/mess-icon1.png" />'+
											'<span class="date txt">报名日期<span>'+
										'</p>'+
										'<p class="mess-date-time clearfix">'+
											'<span class="fr">'+getSubstring(result.data.activity.signupStime,0, 11)+
											'</span>'+
											'<span class="txt fr">至</span>'+
											'<span class="fr">'+getSubstring(result.data.activity.enrollStime,0, 11)+
											'</span>'+
										'</p>'+
									'</div>';
							$('#mess_time').append(messData);
						};
						//会议地点
						$('.act-address').html('地址:'+result.data.activity.province+result.data.activity.city+result.data.activity.location);
						//动态信息
						for(var i=0;i<result.data.news.length;i++){
							if(i>=3){
								break;
							};
							var str = 
								'<li>' + 
									
									'<input type="hidden" value="'+result.data.news[i].id+'"/>' +
									'<a target="_blank" href="" class="newsDetail">' +  getSubstring(result.data.news[i].title, 0, 18)+
									'</a>' +
								'</li>';
							$('.news').append(str);
						};
						$(document).on('click', '.newsDetail', function(){
							var id = $(this).prev().val();
							$(this).attr('href', 'newsDetail.html?newsId='+id);
						})
						//会议议题
						$('#mess_issue').html(result.data.activity.issue)
		    			$('#totalAttend').html(result.data.activity.totalAttend);
		    			$('.issueMove').html(result.data.activity.issue);
						//会议简介
						$('#introduction').html(result.data.activity.introduction);
						if($('#introduction img').width() > $('#introduction').width()){ // 重新设置图片宽高
							var w = $('#introduction img').width();
							var h = $('#introduction img').height();
							var sw = $('#introduction').width();
							$('#introduction img').css({'width':'100%','height':scale(w,h,sw)});
						}

						var height=$('#introduction').height()-$('.introBox').height();
						if(height>0){
							$('.introTxt').html(result.data.activity.introduction);
							$('.look').css('display','block');
							if($('.introTxt img').width() > $('.introTxt').width()){ // 重新设置图片宽高
								var w = $('.introTxt img').width();
								var h = $('.introTxt img').height();
								var sw = $('.introTxt').width();
								$('.introTxt img').css({'width':'100%','height':scale(w,h,sw)});
							}
						};
						//组织机构
						for(var i=0;i<result.data.activityOrgList.length;i++){
							$('.orgList').append(
								'<li class="orgItem">'+
									'<p class="orgType">'+result.data.activityOrgList[i].name+':</p>'+
									'<ul class="orgname">'+
									'</ul>'+
								'</li>');
							var orgList=result.data.activityOrgList[i].value;
							for(var j=0;j<orgList.length;j++){
								$($('.orgname')[i]).append('<li>&nbsp&nbsp'+orgList[j]+'</li>')
							}
						};
						$('.orgList').prepend($(".orgItem:contains('主办单位:')"));
						//联系我们
						$('.contactUser .conTxt').html(result.data.activity.contactUser);
						$('.contactPhone .conTxt').html(result.data.activity.contactPhone);
						$('.contactEmail .conTxt').html(result.data.activity.contactEmail);
						$('.contactAddress .conTxt').html(result.data.activity.contactAddress);
						// $('#contact_our').append(str);
						//会议图片
						if(result.data.imageUrl.length>0||!result.data.imageUrl==null){
							for(var i=0;i<result.data.imageUrl.length;i++){
								$('.mess-img').append('<img class="img1" src="'+basePath+result.data.imageUrl[i]+'" alt="第'+(i+1)+'张图片">');
							};
						}
						
						//嘉宾
						if(!(result.data.expert.length==0)){
							$('.person').css('display','block');
							for(var i=0;i<result.data.expert.length;i++){
								$('.personList').append('<li class="fl">'+result.data.expert[i].expertName+'</li>')
							};
						};
						if(result.data.activity.state!=2){
							actState = result.data.activity.state;
							$('.sign').css('background','#ccc');
							if(actState == 1){
								$('.enroll').html('立即报名');
							} else {
								$('.enroll').html('报名结束');
							}
						};
					}else{
						alert(result.msg);
					};
					if(type){
						// $('.date').html('培训日期');
						$('.time').html('培训时间');
						$('.address').html('培训位置');
					};
				},
				error:function(){
					alert("请求失败");
				}
			});
		};
		// 报名
		$(".enroll").on('click',function(){
			if(actState != 2){
				if(actState == 1){
					myAlert('活动尚未发布，不可报名！','slow');
				} else {
					myAlert('该活动已结束！','slow');
				}
				return false;
			}
			var url = basePath+'index/status.do';
			$.myAjax({
				url: url,
				type: 'GET',
				data:{id:id},
				success:function(result){
					if(result.flag){
						// if(result.data.user){
							window.location.href = 'previewFiled.html?actId='+$("#id").val()+'&logType='+$("#logType").val();
						// }else{
						// 	window.location.href = '../index/login.html';
						// };
					}else{
						alert(result.msg)
					};
				},
				error:function(){
					alert("请求失败")
				}
			});
		});

		//注销
		loginOut('#login_out');
		//二维码
		var qrcode = new QRCode(document.getElementById("qrcode"), {
			width : 100,
			height : 100
		});
		var url= basePath + 'page/weixin/actDetail.html?id='+$("#id").val();
		qrcode.makeCode(url);
		//轮播
		function pictureShow(id,options){
	        var i=0;
	        var timer=null;
	        var options=options||{};
	        var scrollAuto=false;
	        
	        for (var j = 0; j < $(id+' .img li').length; j++) {  //创建圆点
	          $(id+' .num').append('<li></li>')
	        }
	        $(id+' .num li').first().addClass(id+' active'); //给第一个圆点添加样式
	     	var firstimg=$(id+' .img li').first().clone(); //复制第一张图片
	        $(id+' .img').append(firstimg).width($(id+' .img li').length*($(id+' .img img').width())); //将第一张图片放到最后一张图片后，设置ul的宽度为图片张数*图片宽度
	      	// 下一个按钮
	        $(id+' .next').click(function(){
	          i++;
	          if (i==$(id+' .img li').length) {
	            i=1; //这里不是i=0
	            $(id+' .img').css({left:0}); //保证无缝轮播，设置left值
	          };
	      
	          $(id+' .img').stop().animate({left:-i*560},300);
	          if (i==$(id+' .img li').length-1) {   //设置小圆点指示
	            $(id+' .num li').eq(0).addClass(id+' active').siblings().removeClass(id+' active');
	          }else{
	            $(id+' .num li').eq(i).addClass(id+' active').siblings().removeClass(id+' active');
	          }
	        })
	      
	        // 上一个按钮
	        $(id+' .prev').click(function(){
	          i--;
	          if (i==-1) {
	            i=$(id+' .img li').length-2;
	            $(id+' .img').css({left:-($(id+' .img li').length-1)*560});
	          }
	          $(id+' .img').stop().animate({left:-i*560},300);
	          $(id+' .num li').eq(i).addClass(id+' active').siblings().removeClass(id+' active');
	        })
	      
	        //设置按钮的显示和隐藏
	        function buttonShow(){
	            $(id).hover(function(){
	              $(id+' .btn').show();
	            },function(){
	              $(id+' .btn').hide();
	            })
	        }
	        if(options.buttonShow){
	            buttonShow();
	        }
	        //鼠标划入圆点
	        function round(){
	            $(id+' .num li').mouseover(function(){
	            var _index=$(this).index();
	            $(id+' .img').stop().animate({left:-_index*560},800);
	            $(id+' .num li').eq(_index).addClass(id+' active').siblings().removeClass(id+' active');
	            })
	        }
	        if(options.round){
	          round();
	        }
	        //定时器自动播放
	        function autoplay(){
	          timer=setInterval(show,3000)
	        }
	        if(options.autoplay){
	          autoplay();
	        }
	        //鼠标移入，暂停自动播放，移出，开始自动播放
	        function mousehover(){
	            $(id).hover(function(){ 
	              clearInterval(timer);
	            },function(){
	              timer=setInterval(show,3000)
	            })
	        }
	        if(options.mousehover){
	          mousehover();
	        }
	        //图片滚动
	        function show(){
	          i++;
	          if (i==$(id+' .img li').length) {
	            i=1;
	            $(id+' .img').css({left:0});
	          };
	      
	      	  $(id+' .img').stop().animate({left:-i*560},300);
	          if (i==$(id+' .img li').length-1) { 
	            $(id+' .num li').eq(0).addClass(id+' active').siblings().removeClass(id+' active');
	          }else{
	            $(id+' .num li').eq(i).addClass(id+' active').siblings().removeClass(id+' active');
	          }
	        }
    	};
    	//移入查看更多
    	function hoverMore(mouseId,showId){
    		$(mouseId).on('mouseover',function(){
    			$(showId).css('display','block');
    			$(showId).addClass("popupStyle");
    		});
    		$(mouseId).on('mouseout',function(){
    			$(showId).css('display','none');
    		});
    	};
    	hoverMore('.mess_issue','.issueMove');
    	hoverMore('.org','.orginfoMove');
    	hoverMore('.messTime','.messTimeMove');
    	//页面链接
		$('.detail').click(function(){
			$(this).attr('href',window.location);
		});
		//查看详情
		$('.look').on('click',function(){
			$('.introPos').css('display','block');
			mask();
		});
		//删除详情
		$('.introIcon').on('click',function(){
			$('.mask').remove();
			$('.introPos').css('display','none');
		});
	})

// 图片等比缩放
function scale(width,height,swidth){
	var h = (swidth/width * height);
	return h + 'px';
}
</script>
</html>